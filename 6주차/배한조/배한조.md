# 5주차 React 스터디 정리

## 개인이 만든 템플릿입니다! 템플릿이 올라오면 수정 예정

| 장   | 제목                         |
| ---- | ---------------------------- |
| 14장 | 리액트 라우터로 SPA 개발하기 |
| 15장 | Recoil 연습                  |

## 14장

### 14.5 데이터 연동하기

데이터를 패치할 때, useEffect에 등록하는 함수에 async를 붙이면 안된다

useEffect에서 반환해야 하는 값은 뒷정리 함수이기 때문이다

따라서 useEffect 내부에서 async/await을 사용하고 싶다면 함수 내부에 또 다른 함수를 만들어야한다

또 하나 주의해야 할 점은 데이터를 map으로 받아올 때 반드시 받아올 데이터가 있는지 확인해야한다

```javascript
// response 값이 설정되지 않았을 때
if (!response) {
  return null;
}

// response 값이 유효할 때
const { articles } = response.data;
return (
  <NewsListBlock>
    {/* map 함수를 통해 item 추가 */}
    {articles.map((article) => (
      <NewsItem key={article.url} article={article} />
    ))}
  </NewsListBlock>
);
```

### 14.6 카테고리 기능 구현하기

카테고리에 맞는 내용을 보여주기 위한 기능을 구현합니다

```javascript
const Categories = () => {
  return (
    <CategoriesBlock>
      // 카테고리 이름에 맞는 카테고리 컴포넌트를 라우팅 한다
      {categories.map((c) => (
        <Category
          key={c.name}
          activeClassName="active"
          exact={c.name === "all"}
          to={c.name === "all" ? "/" : `/${c.name}`}
        >
          {c.text}
        </Category>
      ))}
    </CategoriesBlock>
  );
};
```

뉴스를 불러올 때 카테고리를 선택하지 않고 불러오고 있는데 이를 해결하기 위해 NewsList 컴포넌트에서 받아온 카테고리에 따라 API를 패치하게 만들자

```javascript
const NewsList = ({ category }) => {
  const (...)

  useEffect(() => { // 데이터 패치
    // async를 사용하는 함수는 따로 선언하자
    const fetchDate = async () => {
      setLoading(true);
      try{
        const query = category === 'all' ? '' : `&category=${category}`; // 쿼리문을 props로 받아온 카테고리로 선택
        const response = await axios.get(`https://newsapi.org/v2/top-headlines?country=kr${query}&apiKey=c0662f2484fb4c458135523c837f41d5`,);
        setArticles(response.data.articles);
      } catch(e){
        console.log(e);
      }
      setLoading(false); // 로딩이 끝났음을 알림
    };
    fetchData();
  }, [category]); // 카테고리가 변했을 때 실행

  (...)
};
```

### 14.7 리액트 라우터 적용하기

리액트 라우터를 사용해 앞서 작성한 내용에 라우팅을 한다

```
yarn add react-router-dom
```

```javascript
const App = () => {
  // 카테고리에 따라 newPage 컴포넌트를 라우트 한다
  return <Route path="/:category?" component={NewsPage} />;
};
```

```javascript
const Categories = () => {
  return (
    <CategoriesBlock>
      {categories.map((c) => (
        <Category
          key={c.name}
          activeClassName="active"
          exact={c.name === "all"}
          to={c.name === "all" ? "/" : `/${c.name}`} // 카테고리가 all일땐 '/' 외에는 카테고리 이름을 주소 명으로 설정
        >
          {c.text}
        </Category>
      ))}
    </CategoriesBlock>
  );
};
```

### 14.8 usePromise 커스텀 Hook 만들기

API 호출처럼 promise를 사용해야할 때 간결하게 코드 작성을 위한 커스텀 Hook을 만들자

```javascript
import { useState, useCallback, useEffect } from "react";

export default function usePromise(promiseCreator, deps) {
  // 대기중, 완료, 실패에 대한 상태관리
  const [loading, setLoading] = useState(false);
  const [resolved, setResolved] = useState(null);
  const [error, setError] = useState(null);

  useEffect(() => {
    const process = async () => {
      setLoading(true);
      try {
        const resolved = await promiseCreator();
        setResolved(resolved);
      } catch (e) {
        setError(e);
      }
      setLoading(false);
    };
    process();
  }, deps);

  // promise의 대기, 완료, 실패에 대한 결과 상태를 리턴
  return [loading, resolved, error];
}
```

위에서 만든 promise 커스텀 hook을 NewsList 컴포넌트에 적용

```javascript
const NewsList = ({ category }) => {
  // 데이터 패치 부분을 커스텀 hook으로 교체함
  const [loading, response, error] = usePromise(() => {
    const query = category === "all" ? "" : `&category=${category}`;
    return axios.get(
      `https://newsapi.org/v2/top-headlines?country=kr${query}&apiKey=c0662f2484fb4c458135523c837f41d5`
    );
  }, [category]);
  (...)
};
```

## 15장(Recoil 대체)

### 소개 - 동기

내용 placeholder

### 소개 - 주요 개념

내용 placeholder

### 소개 - 설치

내용 placeholder

### 소개 - Recoil 시작하기

내용 placeholder

### 기본 자습서 - 도입부

내용 placeholder

### 기본 자습서 - Atoms

내용 placeholder

### 기본 자습서 - Selectors

내용 placeholder

---

질문, 이해가 안 갔던 것, 궁금한 것, 스터디장이나 다른 사람들에게 물어보고 싶은 것, 기타 등등이 있으시면 써주시고, 이 문구는 지워주세요!
