# 6ì£¼ì°¨ React ìŠ¤í„°ë”” ì •ë¦¬

| ì¥     | ì œëª©                                 |
| ------ | ------------------------------------ |
| 14ì¥   | ì™¸ë¶€ APIë¥¼ ì—°ë™í•˜ì—¬ ë‰´ìŠ¤ ë·°ì–´ ë§Œë“¤ê¸° |
| Recoil | Recoil                               |

## 14ì¥

### 14.5 ë°ì´í„° ì—°ë™í•˜ê¸°

ì»´í¬ë„ŒíŠ¸ê°€ í™”ë©´ì— ë³´ì´ëŠ” ì‹œì ì— APIë¥¼ ìš”ì²­í•´ ë³¼ ê²ƒ.

useEffectë¥¼ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ ë Œë”ë§ë˜ëŠ” ì‹œì ì— APIë¥¼ ìš”ì²­í•˜ë©´ ë¨. 

ğŸ“ useEffectì— ë“±ë¡í•˜ëŠ” í•¨ìˆ˜ì— asyncë¥¼ ë¶™ì´ë©´ ì•ˆë¨. â†’ useEffectì—ì„œ ë°˜í™˜í•´ì•¼ í•˜ëŠ” ê°’ì€ ë’·ì •ë¦¬ í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ !

(useEffect ë‚´ë¶€ì—ì„œ async/awaitì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´, í•¨ìˆ˜ ë‚´ë¶€ì— async í‚¤ì›Œë“œê°€ ë¶™ì€ ë˜ ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ ì£¼ì–´ì•¼ í•¨.)

+ loadingì´ë¼ëŠ” ìƒíƒœë„ ê´€ë¦¬í•˜ì—¬, ìš”ì²­ì´  ëŒ€ê¸° ì¤‘ì¼ ë•Œ loading ê°’ì„ trueë¡œ ë†“ê³ , ìš”ì²­ì´ ëë‚˜ë©´ loading ê°’ì„ falseë¡œ ë†“ì•„ API ìš”ì²­ì´ ëŒ€ê¸° ì¤‘ì¸ì§€ íŒë³„í•  ê²ƒ.



```react
import React, { useState, useEffect } from 'react';
import styled from 'styled-components';
import NewsItem from './NewsItem';
import axios from 'axios';

const NewsListBlock = styled.div`
  box-sizing: border-box;
  padding-bottom: 3rem;
  width: 768px;
  margin: 0 auto;
  margin-top: 2rem;
  @media screen and (max-width: 768px) {
    width: 100%;
    padding-left: 1rem;
    padding-right: 1rem;
  }
`;

const NewsList = () => {
  const [articles, setArticles] = useState(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // asyncë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ ë”°ë¡œ ì„ ì–¸
    const fetchData = async () => {
      setLoading(true);
      try {
        const response = await axios.get(
          'https://newsapi.org/v2/top-headlines?country=kr&apiKey=0a8c4202385d4ec1bb-93b7e277b3c51f',
        );
        setArticles(response.data.articles);
      } catch (e) {
        console.log(e);
      }
      setLoading(false);
    };
    fetchData();
  }, []);

  // ëŒ€ê¸° ì¤‘ì¼ ë•Œ
  if (loading) {
    return <NewsListBlock>ëŒ€ê¸° ì¤‘...</NewsListBlock>;
  }
  // ì•„ì§ articles ê°’ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ë•Œ
  if (!articles) {
    return null;
  }

  // articles ê°’ì´ ìœ íš¨í•  ë•Œ
  return (
    <NewsListBlock>
      {articles.map((article) => (
        <NewsItem key={article.url} article={article} />
      ))}
    </NewsListBlock>
  );
};

export default NewsList;

```



### 14.6 ì¹´í…Œê³ ë¦¬ ê¸°ëŠ¥ êµ¬í˜„í•˜ê¸°

- ì¹´í…Œê³ ë¦¬ ì„ íƒ UI ë§Œë“¤ê¸°

```react
import React from 'react';
import styled from 'styled-components';

const categories = [
  {
    name: 'all',
    text: 'ì „ì²´ë³´ê¸°',
  },
  {
    name: 'business',
    text: 'ë¹„ì¦ˆë‹ˆìŠ¤',
  },
  {
    name: 'entertainment',
    text: 'ì—”í„°í…Œì¸ë¨¼íŠ¸',
  },
  {
    name: 'health',
    text: 'ê±´ê°•',
  },
  {
    name: 'science',
    text: 'ê³¼í•™',
  },
  {
    name: 'sports',
    text: 'ìŠ¤í¬ì¸ ',
  },
  {
    name: 'technology',
    text: 'ê¸°ìˆ ',
  },
];

const CategoriesBlock = styled.div`
  display: flex;
  padding: 1rem;
  width: 768px;
  margin: 0 auto;
  @media screen and (max-width: 768px) {
    width: 100%;
    overflow-x: auto;
  }
`;

const Category = styled.div`
  font-size: 1.125rem;
  cursor: pointer;
  white-space: pre;
  text-decoration: none;
  color: inherit;
  padding-bottom: 0.25rem;

  &:hover {
    color: #495057;
  }

  & + & {
    margin-left: 1rem;
  }
`;

const Categories = () => {
  return (
    <CategoriesBlock>
      {categories.map((c) => (
        <Category key={c.name}>{c.text}</Category>
      ))}
    </CategoriesBlock>
  );
};

export default Categories;
```



Appì—ì„œ category ìƒíƒœë¥¼ useStateë¡œ ê´€ë¦¬í•´ ë³¼ ê²ƒ.

ì¶”ê°€ë¡œ category ê°’ì„ ì—…ë°ì´íŠ¸ í•˜ëŠ” onSelect ë¼ëŠ” í•¨ìˆ˜ë„ ë§Œë“¤ì–´ ì¤„ ê²ƒì´ì—ìš”

```react
import React, { useState, useCallback } from 'react';
import Categories from './components/Categories';
import NewsList from './components/NewsList';

const App = () => {
  const [category, setCategory] = useState('all');
  const onSelect = useCallback((category) => setCategory(category), []);

  return (
    <>
      <Categories category={category} onSelect={onSelect} />
      <NewsList category={category} />
    </>
  );
};

export default App;
```



ì¹´í…Œê³ ë¦¬ì— ë”°ë¥¸ ë‰´ìŠ¤ ë‚˜íƒ€ë‚´ê¸°

```react
import React, { useState, useEffect } from 'react';
import styled from 'styled-components';
import NewsItem from './NewsItem';
import axios from 'axios';

const NewsListBlock = styled.div`
  box-sizing: border-box;
  padding-bottom: 3rem;
  width: 768px;
  margin: 0 auto;
  margin-top: 2rem;
  @media screen and (max-width: 768px) {
    width: 100%;
    padding-left: 1rem;
    padding-right: 1rem;
  }
`;

const NewsList = ({ category }) => {
  const [articles, setArticles] = useState(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // asyncë¥¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ ë”°ë¡œ ì„ ì–¸
    const fetchData = async () => {
      setLoading(true);
      try {
        const query = category === 'all' ? '' : `&category=${category}`;
        const response = await axios.get(
          `https://newsapi.org/v2/top-headlines?country=kr${query}&apiKey=0a8c4202385d4ec1bb-93b7e277b3c51f`,
        );
        setArticles(response.data.articles);
      } catch (e) {
        console.log(e);
      }
      setLoading(false);
    };
    fetchData();
  }, [category]);

  // ëŒ€ê¸° ì¤‘ì¼ ë•Œ
  if (loading) {
    return <NewsListBlock>ëŒ€ê¸° ì¤‘...</NewsListBlock>;
  }
  // ì•„ì§ articles ê°’ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ì„ ë•Œ
  if (!articles) {
    return null;
  }

  // articles ê°’ì´ ìœ íš¨í•  ë•Œ
  return (
    <NewsListBlock>
      {articles.map((article) => (
        <NewsItem key={article.url} article={article} />
      ))}
    </NewsListBlock>
  );
};

export default NewsList;
```





### 14.7 ë¦¬ì•¡íŠ¸ ë¼ìš°í„° ì ìš©í•˜ê¸°

ê¸°ì¡´ì—ëŠ” ì¹´í…Œê³ ë¦¬ ê°’ì„ useStateë¡œ ê´€ë¦¬í–ˆë‹¤ë©´, ì´ë²ˆì—ëŠ” ì´ ê°’ì„ ë¦¬ì•¡íŠ¸ ë¼ìš°í„°ì˜ URL íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•´ì„œ ê´€ë¦¬í•´ ë³¼ ê²ƒ.



`yarn add react-router-dom` ëª…ë ¹ì–´ë¡œ ë¦¬ì•¡íŠ¸ ë¼ìš°í„°ë¥¼ ì„¤ì¹˜ í›„, index.jsì— ì ìš©í•˜ê¸°.



NewsPage ìƒì„±

```react
import React from 'react';
import Categories from '../components/Categories';
import NewsList from '../components/NewsList';

const NewsPage = ({ match }) => {
  // ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê¸°ë³¸ê°’ allë¡œ ì‚¬ìš©
  const category = match.params.category || 'all';

  return (
    <>
      <Categories />
      <NewsList category={category} />
    </>
  );
};

export default NewsPage;
```



### 14.8 usePromise ì»¤ìŠ¤í…€ Hook ë§Œë“¤ê¸°

ì»´í¬ë„ŒíŠ¸ì—ì„œ API í˜¸ì¶œì²˜ëŸ¼ Promiseë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš° ë”ìš± ê°„ê²°í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•´ ì£¼ëŠ” **ì»¤ìŠ¤í…€ Hook**ì„ ë§Œë“¤ì–´ì„œ ì ìš©í•´ë´…ì‹œë‹¤.



```react
import { useState, useEffect } from 'react';

export default function usePromise(promiseCreater, deps) {
  // ëŒ€ê¸° ì¤‘/ ì™„ë£Œ/ ì‹¤íŒ¨ì— ëŒ€í•œ ìƒíƒœ ê´€ë¦¬
  const [loading, setLoading] = useState(false);
  const [resolved, setResolved] = useState(null);
  const [error, setError] = useState(null);

  useEffect(() => {
    const process = async () => {
      setLoading(true);
      try {
        const resolved = await promiseCreater();
        setResolved(resolved);
      } catch (e) {
        setError(e);
      }
      setLoading(false);
    };
    process();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, deps);

  return [loading, resolved, error];
}
```



- usePromiseë¥¼ ì‚¬ìš©í•˜ë©´ NewsListì—ì„œ ëŒ€ê¸° ì¤‘ ìƒíƒœ ê´€ë¦¬ì™€ useEffect ì„¤ì •ì„ ì§ì ‘ í•˜ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ ì½”ë“œê°€ í›¨ì‹  ê°„ê²°í•´ì§.
- ìš”ì²­ ìƒíƒœë¥¼ ê´€ë¦¬í•  ë•Œ ë¬´ì¡°ê±´ ì»¤ìŠ¤í…€ Hookì„ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆì§€ë§Œ, ìƒí™©ì— ë”°ë¼ ì ì ˆíˆ ì‚¬ìš©í•˜ë©´ ì¢‹ì€ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ !



### 14.9 ì •ë¦¬

ğŸ“ useEffect ì— ë“±ë¡í•˜ëŠ” í•¨ìˆ˜ëŠ” asyncë¡œ ì‘ì„±í•˜ë©´ ì•ˆë¨.





## Recoil

- Recoil: Reactë¥¼ ìœ„í•œ ìƒíƒœ ê´€ë¦¬ íˆ´ (ì „ì—­ useState)



### ì†Œê°œ. ì£¼ìš”ê°œë…

**Atoms**

ìƒíƒœì˜ ë‹¨ìœ„ì´ë©°, ì—…ë°ì´íŠ¸ì™€ êµ¬ë…ì´ ê°€ëŠ¥í•˜ë‹¤.

atomì´ ì—…ë°ì´íŠ¸ ë˜ë©´, ê°ê°ì˜ êµ¬ë…ëœ ì»´í¬ë„ŒíŠ¸ëŠ” ìƒˆë¡œìš´ ê°’ì„ ë°˜ì˜í•˜ì—¬ ë‹¤ì‹œ ë Œë”ë§ ë¨.

(atomì˜ ê°’ì„ ì½ëŠ” ì»´í¬ë„ŒíŠ¸ë“¤ì€ ì•”ë¬µì ìœ¼ë¡œ atomì„ êµ¬ë…í•˜ê¸° ë•Œë¬¸)

atomsëŠ” ë¦¬ì•¡íŠ¸ì˜ ë¡œì»¬ ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœ ëŒ€ì‹  ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.

ë™ì¼í•œ atomì´ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°, ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” ìƒíƒœë¥¼ ê³µìœ í•¨.



```react
const fontSizeState = atom({ 
    key: 'fontSizeState',
    default: 14,
});
```

ğŸ“ Atoms ëŠ” `atom` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ìƒì„±í•¨.



AtomsëŠ” ê³ ìœ í•œ í‚¤ê°€ í•„ìš”í•œë°, ë‘ ê°œì˜ atomì´ ê°™ì€ í‚¤ë¥¼ ê°–ëŠ” ê²ƒì€ ì˜¤ë¥˜ì´ê¸° ëŒ€ë¬¸ì— í‚¤ê°’ì€ ì „ì—­ì ìœ¼ë¡œ ê³ ìœ í•˜ë„ë¡ í•´ì•¼ í•œë‹¤. React ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœì²˜ëŸ¼ ê¸°ë³¸ê°’ë„ ê°€ì§„ë‹¤.

ğŸ“ ì»´í¬ë„ŒíŠ¸ì—ì„œ atomì„ ì½ê³  ì“°ë ¤ë©´ `useRecoilState` ë¼ëŠ” í›… ì‚¬ìš©.

(ë¦¬ì•¡íŠ¸ useStateì™€ ì°¨ì´: ìƒíƒœê°€ ì»´í¬ë„ŒíŠ¸ ê°„ì— ê³µìœ ë  ìˆ˜ ìˆìŒ.)

```react
function FontButton() {
    const [fontSize, setFontSize] = useRecoilState(fontSizeState);
    return (
    <button onClick={() => setFontSize((size) => size + 1)} style={{fontSize}})>
        Click to Enlarge
        </button>
    );
}
```



**Selectors**

SelectorëŠ” atomsë‚˜ ë‹¤ë¥¸ selectorsë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ ë“¤ì´ëŠ” ìˆœìˆ˜ í•¨ìˆ˜.

ìƒìœ„ atoms ë˜ëŠ” selectorsê°€ ì—…ë°ì´íŠ¸ë˜ë©´ í•˜ìœ„ì˜ selector í•¨ìˆ˜ë„ ë‹¤ì‹œ ì‹¤í–‰ë¨. 



SelectorsëŠ” ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” íŒŒìƒ ë°ì´í„°ë¥¼ ê³„ì‚°í•˜ëŠ” ë° ì‚¬ìš©ë¨.

ìµœì†Œí•œì˜ ìƒíƒœ ì§‘í•©ë§Œ atomsì— ì €ì¥í•˜ê³  ë‹¤ë¥¸ ëª¨ë“  íŒŒìƒë˜ëŠ” ë°ì´í„°ëŠ” selectorsì— ëª…ì‹œí•œ í•¨ìˆ˜ë¥¼ í†µí•´ íš¨ìœ¨ì ìœ¼ë¡œ ê³„ì‚°í•¨ìœ¼ë¡œì¨ ì“¸ëª¨ì—†ëŠ” ìƒíƒœì˜ ë³´ì¡´ì„ ë°©ì§€í•¨.

ì»´í¬ë„ŒíŠ¸ì˜ ê´€ì ì—ì„œ ë³´ë©´ selectorsì™€ atomsëŠ” ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°€ì§€ë¯€ë¡œ ì„œë¡œ ëŒ€ì²´ ê°€ëŠ¥.



```react
const fontSizeLabelState = selector({
    key: 'fontSizeLabelState',
    get: ({get}) => {
        const fontSize = get(fontSizeState);
        const unit = 'px';
        
        return `${fontSize}${unit}`;
    },
});
```

 ğŸ“ SelectorsëŠ” `selector` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ì •ì˜.



`get` ì†ì„±ì€ ê³„ì‚°ë  í•¨ìˆ˜ì¸ë°, ì „ë‹¬ë˜ëŠ” get ì¸ìë¥¼ í†µí•´ atomsì™€ ë‹¤ë¥¸ selectorsì— ì ‘ê·¼ ê°€ëŠ¥.

ë‹¤ë¥¸ atomsë‚˜ selectorsì— ì ‘ê·¼í•˜ë©´ ìë™ìœ¼ë¡œ ì¢…ì† ê´€ê³„ê°€ ìƒì„±ë˜ë¯€ë¡œ, ì°¸ì¡°í–ˆë˜ ë‹¤ë¥¸ atomsë‚˜ selectorsê°€ ì—…ë°ì´íŠ¸ë˜ë©´ ì´ í•¨ìˆ˜ë„ ë‹¤ì‹œ ì‹¤í–‰ë¨.



SelectorsëŠ” `useRecoilValue()`ë¥¼ ì‚¬ìš©í•´ ì½ì„ ìˆ˜ ìˆëŠ”ë°, ì´ í•¨ìˆ˜ëŠ” í•˜ë‚˜ì˜ atomì´ë‚˜ selectorë¥¼ ì¸ìë¡œ ë°›ì•„ ëŒ€ì‘í•˜ëŠ” ê°’ì„ ë°˜í™˜í•œë‹¤.



```react
function FontButton() {
    const [fontSize, setFontSize] = useRecoilState(fontSizeState);
    const fontSizeLabel = useRecoilValue(fontSizeLabelState);
    
    return (
    <>
    	<div>Current font size: ${fontSizeLabel}</div>
    
    	<button onClick={setFontSize(fontSize + 1)} style = {{fontSize}}>
            Click to Enlarge
        </button>
    </>
  );
}
```



### ì†Œê°œ. ì„¤ì¹˜

**npm**

`npm install recoil` í˜¹ì€ `yarn add recoil`



### ì†Œê°œ. Recoil ì‹œì‘í•˜ê¸°

ë¦¬ì•¡íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±í•˜ê¸°

`yarn create react-app my-app`



**RecoilRoot**

`RecoilRoot` ë¥¼ ë„£ê¸°ì— ê°€ì¥ ì¢‹ì€ ì¥ì†ŒëŠ” ë£¨íŠ¸ ì»´í¬ë„ŒíŠ¸ !

```react
import React from 'react';
import {
  RecoilRoot,
  atom,
  selector,
  useRecoilState,
  useRecoilValue,
} from 'recoil';

function App() {
  return (
    <RecoilRoot>
      <CharacterCounter />
    </RecoilRoot>
  );
}
```



**Atom**

Atomì€ ìƒíƒœì˜ ì¼ë¶€ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ì—ì„œë‚˜ ì½ê³  ì“¸ ìˆ˜ ìˆë‹¤.

ì»´í¬ë„ŒíŠ¸ê°€ atomì„ ì½ê³  ì“°ê²Œ í•˜ê¸° ìœ„í•´ì„œëŠ” useRecoilState()ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•˜ë©´ ë¨.

```react
function CharacterCounter() {
  return (
    <div>
      <TextInput />
      <CharacterCount />
    </div>
  );
}

function TextInput() {
  const [text, setText] = useRecoilState(textState);

  const onChange = (event) => {
    setText(event.target.value);
  };

  return (
    <div>
      <input type="text" value={text} onChange={onChange} />
      <br />
      Echo: {text}
    </div>
  );
}
```



**Selector**

SelectorëŠ” íŒŒìƒëœ ìƒíƒœì˜ ì¼ë¶€ë¥¼ ë‚˜íƒ€ë‚´ë©°, íŒŒìƒëœ ìƒíƒœëŠ” ìƒíƒœì˜ **ë³€í™”**ë‹¤.

`useRecoilValue()` í›…ì„ ì‚¬ìš©í•´ì„œ charCountState ê°’ì„ ì½ì„ ìˆ˜ ìˆìŒ.

```react
function CharacterCount() {
    const count = useRecoilValue(charCountState);
    
    return <>Character Count: {count}</>;
}
```





### ê¸°ë³¸ ììŠµì„œ. ë„ì…ë¶€

ê°„ë‹¨í•œ todo ë¦¬ìŠ¤íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì œì‘í•  ê²ƒì…ë‹ˆë‹¹.

- todo ì•„ì´í…œ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ, í•„í„°ë§ / ìœ ìš©í•œ í†µê³„ í‘œì‹œì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ê²ƒ.



### ê¸°ë³¸ ììŠµì„œ. Atoms

AtomsëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœì˜ *source of truthë¥¼ ê°–ëŠ”ë‹¤. (s.o.t ì €ê²Œ ë­”ë° ..)

ìš°ë¦¬ê°€ ë§Œë“¤ todo ë¦¬ìŠ¤íŠ¸ì—ì„œ source of truthëŠ” ì•„ì´í…œì„ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ë¡œ ì´ë£¨ì–´ì§„ ë°°ì—´ì´ ë  ê²ƒ.



atom ë¦¬ìŠ¤íŠ¸ë¥¼ `todoListState`ë¼ê³  í•˜ê³ , ì´ê²ƒì„ atom() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ìƒì„±í•˜ì.

```react
const todoListState = atom({
    key: 'todoListState',
    default: [],
});
```



atomì— ê³ ìœ í•œ keyë¥¼ ì£¼ê³ , ë¹„ì–´ìˆëŠ” ë°°ì—´ ê°’ì„ defaultë¡œ ì„¤ì •.

ì´ atomì˜ í•­ëª©ì„ ì½ê¸° ìœ„í•´, `useRecoilValue()` í›…ì„ ìš°ë¦¬ì˜ `TodoList` ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ.

```react
function TodoList() {
    const todoList = useRecoilValue(todoListState);
    
    return (
      <>
        {/* <TodoListStats /> */}
        {/* <TodoListStats /> */}
		<TodoItemCreator />

		{todoList.map((todoItem) => (
        	<TodoItem key={todoItem.id} item={todoItem} />
        ))}
	  </>
    );
}
```



ìƒˆë¡œìš´ todo ì•„ì´í…œ ìƒì„±ì„ ìœ„í•´ì„œ, `todoListState` ë‚´ìš©ì„ ì—…ë°ì´íŠ¸ í•˜ëŠ” setter í•¨ìˆ˜ì— ì ‘ê·¼.

`TodoItemCreator` ì»´í¬ë„ŒíŠ¸ì˜ setter í•¨ìˆ˜ë¥¼ ì–»ê¸° ìœ„í•´ `useSetRecoilState()` í›… ì‚¬ìš©.

```react
function TodoItemCreator() {
    const [inputValue, setInputValue] = useState('');
    const setTodoList = useSetRecoilState(todoListState);
    
    const addItem = () => {
        setTodoList((oldTodoList) => [
            ...oldTodoList,
            {
                id: getId(),
                text: inputValue,
                isComplete: false,
            },
        ]);
        setInputValue('');
    };
    
    const onChange = ({target: {value}}) => {
        setInputValue(value);
    };
    
    return (
      <div>
        <input type="text" value={inputValue} onChange={onChange} />
        <button onClick={addItem}>Add</button>
      </div>
    );
}

// ê³ ìœ í•œ Id ìƒì„±ì„ ìœ„í•œ ìœ í‹¸ë¦¬í‹°
Let id = 0;
function getId() {
    return id++;
}
```

ğŸ“ ê¸°ì¡´ todo ë¦¬ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒˆ todo ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ setter í•¨ìˆ˜ì˜ updater í˜•ì‹ì„ ì‚¬ìš©í•œë‹¤ëŠ” ì ì— ìœ ì˜í•´ì•¼ í•¨.



`todoListState`ë¥¼ ì½ê³  í•­ëª© í…ìŠ¤íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³ , ì™„ë£Œëœ ê²ƒìœ¼ë¡œ í‘œì‹œí•˜ê³ , ì‚­ì œí•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” setter í•¨ìˆ˜ë¥¼ ì–»ê¸° ìœ„í•´ `useRecoilState()`ë¥¼ ì‚¬ìš©í•¨.

```react
function TodoItem({item}) {
  const [todoList, setTodoList] = useRecoilState(todoListState);
  const index = todoList.findIndex((listItem) => listItem === item);

  const editItemText = ({target: {value}}) => {
    const newList = replaceItemAtIndex(todoList, index, {
      ...item,
      text: value,
    });

    setTodoList(newList);
  };

  const toggleItemCompletion = () => {
    const newList = replaceItemAtIndex(todoList, index, {
      ...item,
      isComplete: !item.isComplete,
    });

    setTodoList(newList);
  };

  const deleteItem = () => {
    const newList = removeItemAtIndex(todoList, index);

    setTodoList(newList);
  };

  return (
    <div>
      <input type="text" value={item.text} onChange={editItemText} />
      <input
        type="checkbox"
        checked={item.isComplete}
        onChange={toggleItemCompletion}
      />
      <button onClick={deleteItem}>X</button>
    </div>
  );
}

function replaceItemAtIndex(arr, index, newValue) {
  return [...arr.slice(0, index), newValue, ...arr.slice(index + 1)];
}

function removeItemAtIndex(arr, index) {
  return [...arr.slice(0, index), ...arr.slice(index + 1)];
}
```





### ê¸°ë³¸ ììŠµì„œ. Selectors

ìœ„ì—ì„œ Selectorê°€ íŒŒìƒëœ ìƒíƒœì˜ ì¼ë¶€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤ê³  í–ˆëŠ”ë°, ì´ê²ƒì€ ë‹¤ë¥¸ ë°ì´í„°ì— ì˜ì¡´í•˜ëŠ” ë™ì ì¸ ë°ì´í„°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ê°•ë ¥í•œ ê°œë…ì„ !

ìš°ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì•„ë˜ ë‘ê°€ì§€ê°€ íŒŒìƒëœ ìƒíƒœë¡œ ê°„ì£¼ë¨.

- í•„í„°ë§ ëœ todo ë¦¬ìŠ¤íŠ¸: ì „ì²´ todo ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¼ë¶€ ê¸°ì¤€ì— ë”°ë¼ íŠ¹ì • í•­ëª©ì´ í•„í„°ë§ ë””ã…—ã„´ ìƒˆ ë¦¬ìŠ¤íŠ¸(ex: ì´ë¯¸ ì™„ë£Œëœ í•­ëª© í•„í„°ë§) ë¥¼ ìƒì„±ë˜ì–´ íŒŒìƒëœë‹¤.
- Todo ë¦¬ìŠ¤íŠ¸ í†µê³„: ì „ì²´ todo ë¦¬ìŠ¤íŠ¸ì—ì„œ ëª©ë¡ì˜ ì´ í•­ëª© ìˆ˜, ì™„ë£Œëœ í•­ëª© ìˆ˜, ì™„ë£Œëœ í•­ëª©ì˜ ë°±ë¶„ìœ¨ ê°™ì€ ë¦¬ìŠ¤íŠ¸ì˜ ìœ ìš©í•œ ì†ì„±ë“¤ì„ ê³„ì‚°í•˜ì—¬ íŒŒìƒëœë‹¤.



í•„í„°ë§ ëœ todo ë¦¬ìŠ¤íŠ¸ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” atomì— ì €ì¥ë  ìˆ˜ ìˆëŠ” í•„í„° ê¸°ì¤€ì„ ì„ íƒí•´ì•¼ í•¨.

"Show All", "Show Completed", "Show Uncompleted" ì´ë ‡ê²Œ ì„¸ ê°€ì§€ í•„í„° ì˜µì…˜ì´ ìˆëŠ”ë°, ê¸°ë³¸ê°’ì€ "Show All" ì„.

```react
const todoListFilterState = atom({
  key: 'todoListFilterState',
  default: 'Show All',
});
```



`todoListFilterState` ì™€ `todoListState` ë¥¼ ì‚¬ìš©í•´ì„œ í•„í„°ë§ ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ íŒŒìƒí•˜ëŠ” `filteredTodoListState` selectorë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. 

```react
const filteredTodoListState = selector({
  key: 'filteredTodoListState',
  get: ({get}) => {
    const filter = get(todoListFilterState);
    const list = get(todoListState);

    switch (filter) {
      case 'Show Completed':
        return list.filter((item) => item.isComplete);
      case 'Show Uncompleted':
        return list.filter((item) => !item.isComplete);
      default:
        return list;
    }
  },
});
```



`filteredTodoListState` ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `todoListFilterState`ì™€ `todoListState`ë¥¼ ì¶”ì í•˜ë¯€ë¡œ ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ë³€í•˜ë©´ `filteredTodoListState` ëŠ” ì¬ ì‹¤í–‰ ë¨.



í•„í„°ë§ ëœ todo ë¦¬ìŠ¤íŠ¸ í‘œì‹œ.

```react
function TodoList() {
  // changed from todoListState to filteredTodoListState
  const todoList = useRecoilValue(filteredTodoListState);

  return (
    <>
      <TodoListStats />
      <TodoListFilters />
      <TodoItemCreator />

      {todoList.map((todoItem) => (
        <TodoItem item={todoItem} key={todoItem.id} />
      ))}
    </>
  );
}
```



UIëŠ” 'toListFilterState'ì˜ ê¸°ë³¸ê°’ì¸ 'Show All'ê³¼ ë™ì¼í•¨. 

í•„í„°ë¥¼ ë³€ê²½í•˜ë ¤ë©´ `TodoListFilter` ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬í˜„í•´ì•¼ í•¨.

```react
function TodoListFilters() {
  const [filter, setFilter] = useRecoilState(todoListFilterState);

  const updateFilter = ({target: {value}}) => {
    setFilter(value);
  };

  return (
    <>
      Filter:
      <select value={filter} onChange={updateFilter}>
        <option value="Show All">All</option>
        <option value="Show Completed">Completed</option>
        <option value="Show Uncompleted">Uncompleted</option>
      </select>
    </>
  );
}
```



- todo í•­ëª©ë“¤ì˜ ì´ê°œìˆ˜
- ì™„ë£Œëœ todo í•­ëª©ë“¤ì˜ ì´ê°œìˆ˜
- ì™„ë£Œë˜ì§€ ì•Šì€ todo í•­ëª©ë“¤ì˜ ì´ê°œìˆ˜
- ì™„ë£Œëœ í•­ëª©ì˜ ë°±ë¶„ìœ¨

ìœ„ ë„¤ê°œì˜ í†µê³„ë¥¼ í‘œì‹œí•˜ë ¤ê³  í•˜ëŠ”ë°, í•„ìš”í•œ ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” selector í•˜ë‚˜ë¥¼ ë§Œë“¤ ê²ƒì„. ì´ê²ƒì„ `todoListStatsState`ë¼ê³  ë¶€ë¥¼ ê²ƒ.

```react
const todoListStatsState = selector({
  key: 'todoListStatsState',
  get: ({get}) => {
    const todoList = get(todoListState);
    const totalNum = todoList.length;
    const totalCompletedNum = todoList.filter((item) => item.isComplete).length;
    const totalUncompletedNum = totalNum - totalCompletedNum;
    const percentCompleted = totalNum === 0 ? 0 : totalCompletedNum / totalNum;

    return {
      totalNum,
      totalCompletedNum,
      totalUncompletedNum,
      percentCompleted,
    };
  },
});
```



`todoListStatsState`ê°’ì„ ì½ê¸° ìœ„í•´, `useRecoilValue()`ë¥¼ í•œ ë²ˆ ë” ì‚¬ìš©í•  ê²ƒ.

```react
function TodoListStats() {
  const {
    totalNum,
    totalCompletedNum,
    totalUncompletedNum,
    percentCompleted,
  } = useRecoilValue(todoListStatsState);

  const formattedPercentCompleted = Math.round(percentCompleted * 100);

  return (
    <ul>
      <li>Total items: {totalNum}</li>
      <li>Items completed: {totalCompletedNum}</li>
      <li>Items not completed: {totalUncompletedNum}</li>
      <li>Percent completed: {formattedPercentCompleted}</li>
    </ul>
  );
}
```





------

